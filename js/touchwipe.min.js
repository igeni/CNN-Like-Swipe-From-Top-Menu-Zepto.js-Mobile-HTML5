/**
 * @author Tegan Snyder, (http://www.tegdesign.com)
 * Modified version of jQuery touchwipe, stripped down just for purpose of wipeUp and wipeDown
 * Modified to work with Zepto.js
 * @author jQuery touchwipe - Andreas Waltl, netCU Internetagentur (http://www.netcu.de)
 */
(function($) { 
   $.fn.swipeslide = function(settings) {
     var config = {
    		min_move_y: 20,
			preventDefaultEvents: true
	 };
	 
     
     if (settings) $.extend(config, settings);
 
     this.each(function() {
	 
    	 var startY;
		 var isMoving = false;

    	 function cancelTouch() {
    		 this.removeEventListener('touchmove', onTouchMove);
    		 startX = null;
    		 isMoving = false;
    	 }	
    	 
    	 function onTouchMove(e) {
    		 if(config.preventDefaultEvents) {
    			 e.preventDefault();
    		 }
    		 if(isMoving) {
			 
				var y = e.touches[0].pageY;
				var dy = startY - y;

				console.log(dy);

				if(Math.abs(dy) >= config.min_move_y) {
					cancelTouch();
				}

				 if(dy > 0) {
				
					// console.log('up');
					
					dy = Math.abs(parseInt($('header nav').css('top').split('px')[0],10)) - dy;
					
					$('header').css('top', Math.abs(dy) + 'px');
					$('header').removeClass('header-rested').addClass('header-dragged');
					$('#puller').removeClass('puller-rested').addClass('puller-dragged');

					// var cur = $('header').css('top').split('px')[0];
					// console.log('current: ' + cur);
					// console.log(dy);
					

					// $('header nav').css('top', '-1000px');
					// $('header').css('top', '-40px');
					// $('#puller').removeClass('puller-dragged').addClass('puller-rested');
					// $('.puller-rested').css('top', '26px');


				} else {
				
					//console.log('down');
					
					$('header').css('top', Math.abs(dy) + 'px');
					$('header').removeClass('header-rested').addClass('header-dragged');
					$('#puller').removeClass('puller-rested').addClass('puller-dragged');
					
				}
				 
	    	
    		 }
    	 }
    	 
    	 function onTouchStart(e)
    	 {
    		 if (e.touches.length == 1) {
    			 startY = e.touches[0].pageY;
    			 isMoving = true;
    			 this.addEventListener('touchmove', onTouchMove, false);
    		 }
    	 }    	 
		 
		 	
		 
    	 //if ('ontouchstart' in document.documentElement) {
    		 this.addEventListener('touchstart', onTouchStart, false);
    	// }
     });
 
     return this;
   };
 
 })($);